syntax = "proto3";

package NetworkMessageProto;

message GenericMessage
{
    uint32 Target = 1;
    uint32 Type = 2;
    InputMessage InputMsg = 3;
    StateUpdateMessage StateMsg = 4;
    PlayersUpdateMessage PlayersMsg = 5;
    LearnSkillMessage LearnSkillMsg = 6;
}

message Vec2
{
    float X = 1;
    float Y = 2;
}

message ColorProto
{
    float R = 1;
    float G = 2;
    float B = 3;
    float A = 4;
}

message RectProto
{
    float X = 1;
    float Y = 2;
    float Width = 3;
    float Height = 4;
}

message InputMessage
{
    int32 PlayerId = 1;
    uint32 Tick = 2;
    uint32 Type = 3;
    Vec2 MoveInput = 4;
    Vec2 LookInput = 5;
}

message PlayerState
{
    // next index = 21,30
    int32 PlayerId = 1;
    string PlayerName = 2;
    float MaxHp = 3;
    float CurrentHp = 4;
    float MoveSpeed = 5; // 人物移动速度
    float BulletSpeed = 6; // 子弹飞行速度
    float Damage = 7; //  伤害，由DamageUp计算出来
    float DamageUp = 23; // 累积伤害加成，道具增加的伤害加成最终玩家实际造成的伤害为，Damage*sqrt(1+1.2*DamageUp)
    float DamageAdjustment = 27;  // 伤害修正系数，默认为1
    float HpStealFix = 28;      // 固定生命偷取，和造成的伤害无关
    float AttackFrequency = 8; // 攻击频率/每秒发射子弹数，数值由AttackDelay计算出来
    float AttackFreqUp = 24;
    float ShootRange = 9; // 攻击范围，不一定是射击
    float CriticalRate = 10; // 暴击率
    uint32 CurrentLevel = 12;
    uint32 CurrentExp = 13;
    uint32 ExpGiven = 25;
    Vec2 Position = 11;
    repeated int32 SkillIds = 14;
    bool CurrentStageSkillLearned = 15;
    repeated int32 ToLearnedSkillIds = 19;
    int32 ActiveSkillId = 16;
    int32 ActiveSkillCurCd = 20;
    float Scale = 17;
    ColorProto Color = 18;
    repeated PlayerState CatchedMinionStates = 22;
    map<int32, PlayerState> StolenStates = 26;
    int32 CharacterSpawnConfigId = 29;
}

message BulletState
{
    int32 ShootNum = 1;
    int32 ShootAngleRange = 2;
    int32 PenetrateCount = 3;
    int32 SplitCount = 4;
    int32 HomingForce = 5;
    int32 BounceCount = 6;
    bool CanDestroyObstacle = 7;
    int32 ConfuseTargetTime = 8;
    bool IsReturnBullet = 9;
    bool IsStealBullet = 10;
}

message StateUpdateMessage
{
    repeated PlayerState Players = 1;
    uint32 Tick = 2;
}

message PlayersUpdateMessage
{
    repeated PlayerInfo Players = 1;
}

message PlayerInfo
{
    string CSteamID = 1; // CSteamID or a string for local players
    string Name = 2;
    int32 Id = 3;
    int32 CharacterSpawnConfigId = 4;
}

message LearnSkillMessage
{
    int32 playerId = 1;
    int32 skillId = 2;
}

message PickupItem
{
    int32 Id = 1;
    int32 SkillId = 2;
    int32 CurrentCooldown = 3;
    Vec2 Position = 4;
}

message BossPrefabInfo
{
    int32 StageId = 1;
    int32 PrefabId = 2;
}

message MinionPrefabInfo
{
    int32 StageId = 1;
    int32 PrefabId = 2;
}

message LocalStorage
{
    // next index = 4,6,14, 31
    int32 CurrentStage = 1;
    repeated PlayerState PlayerStates = 2;
    repeated BulletState BulletStates = 15;
    repeated PlayerState MinionStates = 3;
    repeated PlayerState BossStates = 5;
    repeated RectProto Rooms = 7;
    uint32 RoomMaxWidth = 8;
    uint32 RoomMaxHeight = 9;
    uint32 NextCharacterId = 10;
    Vec2 TeleportPosition = 11;
    repeated PickupItem PickupItems = 12;
    repeated int32 PassedStages = 13;
    bool Achievement1NewCycle = 16;
    bool Achievement2Mirror = 17;
    bool Achievement3InfiniteLonely = 18;
    bool NewLevel = 19;
    bool ShowedSysErrLogTip = 20;
    PlayerState NewRulerPlayerState = 21;
    BulletState NewRulerBulletState = 22;
    int32 NewRulerCharacterSpawnConfigId = 23;
    int32 NxtDestoryRoomIdx = 24;
    float DestoryRoomRemainTime = 25;
    repeated TileInfo WallTiles = 26;
    repeated TileInfo FloorTiles = 27;
    repeated TileInfo HoleTiles = 28;
    int32 PlayCount = 29;
    map<int32, bool> PlayerLockStates = 30;
}

message TileInfo
{
    int32 X = 1;
    int32 Y = 2;
    int32 TileType = 3;
    int32 TileTemplateId = 4;
    int32 TileId = 5;
}